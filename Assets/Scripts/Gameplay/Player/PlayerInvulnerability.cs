using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerInvulnerability : MonoBehaviour
{
    #region SerializedFields

    [SerializeField] private SimpleEventSO HitObstacle;
    [SerializeField] private float duration = 1.5f;
    
    [SerializeField] private PlayerAnimator animator;
    #endregion

    #region API

    private bool isInvulnerable = false;

    public bool GetIsInvulnerable() => isInvulnerable;

    public void SetInvulnerability()
    {
        if (!isInvulnerable)
        {
            isInvulnerable = true;
            animator.LaunchInvulnerableAnim(true);
            
            StartCoroutine(OnSetInvulnerability());
        }
    }
    #endregion

    #region UnityMethods

    private void OnEnable()
    {
        HitObstacle.OnEventRaised += SetInvulnerability;
    }

    private void OnDisable()
    {
        HitObstacle.OnEventRaised -= SetInvulnerability;
    }

    #endregion

    #region Private
    private IEnumerator OnSetInvulnerability()
    {
        yield return new WaitForSeconds(duration);
        
        isInvulnerable = false;
        animator.LaunchInvulnerableAnim(false);
    }
    #endregion
}
